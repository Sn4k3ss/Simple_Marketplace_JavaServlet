<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
  <title>Marketplace App</title>
  <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" media="all"
          href="../css/search.css" th:href="@{/css/myStyle.css}" />

</head>

<body>

<h1>Welcome to our marketplace <span th:text="${session.user.userName}">Amadeus</span></h1>

<!-- Quick links-->
<div class="styled-quick-links">
  <p>Quick links</p>
  <a th:href="@{/home}">Home</a>
  <a th:href="@{/shoppingCart}">Shopping cart</a>
  <a th:href="@{/orders}">My Orders</a>
  <a th:href="@{/logout}">Logout</a>
</div>


<!-- Search form-->
<div class="styled-form-button">
    <form action="search/products" method="GET">
        <p>Cosa vuoi cercare di bello? </p>
        <input th:placeholder="'Oasis..'" name="keyword" >
        <input class="go-search-button" type="submit" value="vai!">
    </form>
</div>



<div>
    <table class="styled-table">
        <caption>Seen recently</caption>
        <thead>
        <tr>
            <th colspan="2" scope="col">Product</th>
            <th scope="col">Description</th>
            <th scope="col">Cost</th>
            <th scope="col">Supplier</th>
            <th scope="col">Add to cart</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="productId : ${products.supplierProductMultiMap.keySet()}" th:with="productInfo1=${products.supplierProductMultiMap.get(productId)[0]}">
            <td class="table-image">
                <img th:src="'https://tiw21marketplace.s3.eu-south-1.amazonaws.com/images/products/'+ ${productInfo1.productImagePath}" alt="Product image"/>
            </td>
            <td>
                <!-- form reso cliccabile e modificato con css -->
                <form th:action=" ${#request.contextPath} + '/home' " method="POST" >
                    <!-- il tag input vine utilizzato per mandare parametri nella richiesta -->
                    <input type="hidden" name="productId" th:value="${productId}" value="Id prodotto">
                    <input type="submit" name="productName" th:value="${productInfo1.productName}" value="Nome prodotto" class="link-button">
                    <!-- il tag button può essere utilizzato per inserire STATICAMENTE il testo del link -->
                    <!-- <button type="submit" class="link-button"> Testo del link</button> -->
                    <!-- inserire più 'type=submit' fa comparire più bottoni -->
                </form>
            </td>
            <td th:text="${productInfo1.productDescription}"></td>
            <td th:text="${productInfo1.supplierProductCost}"></td>  <!-- if product.isOnDiscount 'illimuna prezzo' -->
            <td th:text="${productInfo1.supplierName}"></td>
            <td>
                <form th:action="${#request.contextPath} + '/products/AddToCart'"  th:object="${productInfo1}" method="POST">
                    <input type="hidden" th:value="${productInfo1.productId}"    name="productId" />
                    <input type="hidden" th:value="${productInfo1.supplierId}"   name="supplierId" />
                    <input type="hidden" th:value="${productInfo1.supplierProductCost}"   name="supplierProductCost" />
                    <input type="submit"                                    value="One-click buy" />
                </form>
            </td>

            <!--    Questa entry della tabela contine tutte le informazioni sui venditori di tale prodotto
                    che si è deciso di non mostrare per rendere più fluida l'esperienza utente almeno nella home
            <td>
                <table th:each="supplier : ${products.supplierProductMultiMap.get(productId)}">
                    <caption>Suppliers</caption>
                    <thead>
                    <tr>
                        <th scope="col">Supplier</th>
                        <th scope="col">Cost</th>
                        <th scope="col">Rating</th>
                        <th scope="col">Range</th>
                        <th scope="col">Add to cart</th>
                    </tr>
                    </thead>
                    <tr>
                        <td th:text="${supplier.supplier.supplierName}"> Venditore 0</td>
                        <td th:text="${supplier.supplierProductCost}">2000.00</td>
                        <td th:text="${supplier.supplier.supplierRating}">0.0</td>
                        <td>
                            <table>
                                <thead>
                                <tr>
                                    <th scope="col">Range</th>
                                    <th scope="col">minItem</th>
                                    <th scope="col">maxItem</th>
                                    <th scope="col">cost</th>
                                </tr>
                                </thead>
                                <tr th:each="range : ${supplier.supplier.supplierShippingPolicy.ranges}" >
                                    <td th:text="${supplier.supplier.supplierShippingPolicy.ranges.indexOf(range) + 1}">1</td>
                                    <td th:text="${range.minAmount}">1</td>
                                    <td th:text="${range.maxAmount}">5</td>
                                    <td th:text="${range.cost}">100,99</td>
                                </tr>
                            </table>
                        </td>
                        <td>
                            <form th:action="${#request.contextPath} + '/products/AddToCart'" method="POST">
                                <label for="int">How many:</label>
                                <select name="howMany" id="int">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="3">5</option>
                                    <option value="3">6</option>
                                    <option value="3">7</option>
                                    <option value="3">8</option>
                                    <option value="3">9</option>
                                </select>
                                <input type="hidden" th:value="${productInfo1.productId}"    name="productId" />
                                <input type="hidden" th:value="${productInfo1.supplierId}"   name="supplierId" />
                                <input type="hidden" th:value="${productInfo1.supplierProductCost}"   name="supplierProductCost" />
                                <input type="submit" value="Add to cart">
                            </form>
                        </td>
                    </tr>
                </table>
            </td>
            -->
        </tr>
        </tbody>
    </table>
</div>

<h3>User info</h3>

<p th:class="bold_info" th:with="address=${userInfo.getShippingAddresses().get(0)}">
    This is your e-mail:<span th:text="${userInfo.email}">amadeus.wgang@gmail.com </span> <br>
    Name: <span th:text="${userInfo.userName}">Amadeus</span> <br>
    Surname: <span th:text="${userInfo.userSurname}">Mozart</span> <br>
    Id: <span th:text="${userInfo.userId}">0</span> <br>
    Your country is: <span th:text="${#locale.country}">AT</span> <br>
    Your default Shipping Address: <span th:text="${address.recipient} + ' ' + ${address.address} +  ' ' + ${address.city} +  ' ' + ${address.state} +  ' ' + ${address.phone}">Via della nota d'oro, Vienna, Austria</span>
</p>

</body>
</html>