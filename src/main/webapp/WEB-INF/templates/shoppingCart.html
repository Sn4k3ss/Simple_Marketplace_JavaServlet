<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Marketplace App</title>
  <meta charset="UTF-8">

  <link rel="stylesheet" type="text/css" media="all"
        href="../CSS/myStyle.css" th:href="@{/css/myStyle.css}" />
</head>

<body>


<div class="topnav">
  <p>Link veloci</p>
  <a th:href="@{/home}">Home</a>
  <a th:href="@{/shoppingCart}">Shopping cart</a>
  <a th:href="@{/orders}">My Orders</a>
  <a th:href="@{/logout}">Logout</a>
</div>

<h1>Here's your shopping cart, <span th:text="${session.user.userName}"> Amadeus</span> </h1>



<div th:if="${not #maps.isEmpty(shoppingCart.shoppingCartList.asMap())}">
  <table class="styled-table" style="width:100%">
    <!-- se il carrello Ã¨ vuoto non mostrare la tabella -->
    <caption style="lighting-color: #04AA6D">CART</caption>
      <thead>
        <tr>
          <th scope="col">Product name</th>
          <th scope="col">Product Description</th>
          <th scope="col">Category</th>
          <th scope="col">Cost</th>
          <th scope="col">How many</th>
        </tr>
      </thead>
    <tbody th:each="supplierId : ${shoppingCart.shoppingCartList.keySet()}" th:with="supplierInfo=${shoppingCart.shoppingCartList.get(supplierId)[0].supplier}" >

      <tr th:each="product : ${shoppingCart.shoppingCartList.get(supplierId)}" >
          <td th:text="${product.productName}">Nome prodotto</td>
          <td th:text="${product.productDescription}">Descrizione prodotto</td>
          <td th:text="${product.productCategory}">Categoria del prodotto</td>
          <td th:text="${product.supplierProductCost}">{Costo unitario}</td>
          <td th:text="${product.howMany}">Quanti nel carrello</td>
          <td>
            <table>
              <thead>
              <tr>
                <th scope="col">Supplier</th>
                <th scope="col">Rating</th>
                <th scope="col">Ranges</th>
              </tr>
              </thead>
              <tr>
                <td th:text="${supplierInfo.supplierName}"> Venditore 0</td>
                <td th:text="${supplierInfo.supplierRating}"> 0</td>
                <td>
                  <table th:with="rangeCounter=0">
                    <thead>
                    <tr>
                      <th scope="col">Range</th>
                      <th scope="col">minItem</th>
                      <th scope="col">maxItem</th>
                      <th scope="col">cost</th>
                    </tr>
                    </thead>
                    <tr th:each="range : ${supplierInfo.supplierShippingPolicy.ranges}">
                      <td th:text="${rangeCounter+1}">1</td>
                      <td th:text="${range.minAmount}">1</td>
                      <td th:text="${range.maxAmount}">5</td>
                      <td th:text="${range.cost}">100,99</td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          </td>
      </tr>
      <tr th:with="totalamount=${shoppingCart.totalAmountBySupplier.get(supplierId)}">
        <td th:text="'Total amount on ' + ${supplierInfo.supplierName} + ': ' + ${totalamount}">Costo totale per venditore</td>
        <td th:if="${ totalamount <= supplierInfo.freeShippingMinAmount }" th:text="'Free shipping on ' + ${supplierInfo.supplierName} + ': ' + ${supplierInfo.freeShippingMinAmount}"> Spesa minima per spedizione gratuita </td>
      </tr>
      <tr>
        <td>
          <form th:action="${#request.contextPath} + '/placeOrder'" method="POST">
            <input type="hidden"  name="supplierId" th:value="${supplierId}" >
            <input type="submit" value="Place order">
          </form>
        </td>
      </tr>



    </tbody>
  </table>
</div>


<p>
<h4>User info</h4>
This is your e-mail:
  <span th:text="${session.user.email}">amadeus.wgang@gmail.com </span> <br>
  Name:
  <span th:text="${session.user.userName}">Amadeus</span> <br>
  Surname:
  <span th:text="${session.user.userSurname}">Mozart</span> <br>
  Id:
  <span th:text="${session.user.userId}">0</span> <br>
  Your country is: <span th:text="${#locale.country}">IT</span>
</p>



</body>
</html>